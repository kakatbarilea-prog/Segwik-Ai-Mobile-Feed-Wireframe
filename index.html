<!DOCTYPE html>  
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Segwik AI – Mobile Feed Wireframe</title>
<style>
  :root{
    --bg:#f6f8fb; --card:#ffffff; --ink:#243048; --muted:#667085; --line:#e6ebf2; --accent:#0F2D56; --btn:#1d305e;

    /* phone size */
    --phone-w: 430px;
    --phone-h: 800px;

    /* modal brand accents */
    --modal-bg: #ffffff;
    --modal-ring: #cfe1ff;
    --modal-shadow: 0 20px 50px rgba(15,45,86,.18);
    --pill-bg: #eef4ff;
    --pill-border: #cfe1ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:'Segoe UI',system-ui,-apple-system,BlinkMacSystemFont,'Helvetica Neue',Arial,sans-serif}
  .wrap{display:flex;align-items:center;justify-content:center;min-height:100%;padding:18px}

  .phone{width:var(--phone-w);height:var(--phone-h);background:#fff;border-radius:36px;box-shadow:0 20px 60px rgba(0,0,0,.12),0 8px 16px rgba(0,0,0,.08);position:relative;overflow:hidden;border:8px solid #111;display:flex;flex-direction:column}
  .notch{position:absolute;top:8px;left:50%;transform:translateX(-50%);width:180px;height:30px;background:#111;border-radius:20px 20px 28px 28px;z-index:10}
  .status{height:46px;padding:0 16px;display:flex;align-items:center;justify-content:center;gap:8px;border-bottom:1px solid var(--line);background:#fff;z-index:5}
  .status .logo{display:flex;align-items:center;gap:8px;font-weight:700;letter-spacing:.3px}
  .status .logo .bot{width:22px;height:22px;border-radius:50%;background:linear-gradient(145deg,#e9f0ff,#dfe9ff);display:grid;place-items:center;border:1px solid #c9d7ff}
  .status .logo .bot::before{content:"";width:10px;height:6px;border-radius:3px;display:block;background:#0F2D56;box-shadow:0 0 0 2px #b7ccff inset}

  .content{
    flex:1; overflow:auto; scroll-snap-type:y mandatory; overscroll-behavior:contain; background:var(--bg)
  }

  /* one full screen per contact */
  .person{scroll-snap-align:start;scroll-snap-stop:always;display:flex;flex-direction:column}
  .content > .person{min-height:100%}
  .person .pane{background:var(--card);border-bottom:1px solid var(--line)}

  /* profile */
  .profile{padding:12px 12px;display:grid;grid-template-columns:96px 1fr;gap:12px;align-items:center;position:relative}
  .avatar{width:96px;height:96px;border-radius:50%;background:#dbe4ff;display:grid;place-items:center;font-weight:700;color:#0F2D56;border:2px solid #c8d4ff;font-size:24px}
  .p-meta{display:grid;gap:4px}
  .p-name{font-size:22px;font-weight:800;color:#0F2D56}
  .p-line{font-size:14px;color:#667085}
  .p-extra{font-size:13px;color:#667085}
  .p-contact{display:grid;gap:4px;margin-top:4px;font-size:13px;color:var(--ink)}
  .p-contact span{display:flex;align-items:center;gap:6px}
  .p-contact svg{width:14px;height:14px;stroke:var(--ink)}

  /* suggestion box */
  .suggest{padding:14px 16px;background:#fbfdff;border-top:1px dashed #e3ecff;border-bottom:1px dashed #e3ecff;display:flex;flex-direction:column;gap:10px; position:relative; overflow:hidden}
  .suggest .spark{font-weight:700;margin-bottom:6px}
  .suggest .links{display:flex;justify-content:flex-end;gap:14px}
  .suggest a{color:#2b5bd7;text-decoration:none;font-size:12px}

  /* close X — large hit target */
  .suggest .close-x{
    position:absolute; right:6px; top:6px; width:28px; height:28px; border-radius:8px;
    display:grid; place-items:center; font-weight:800; color:#4b5563; background:#eef4ff; cursor:pointer;
    border:1px solid #d9e4ff; user-select:none; z-index:2;
  }
  .suggest .close-x:active{transform:scale(0.96)}

  /* card + animation items */
  .suggest-card{ position:relative; min-height:64px }
  .suggest-item{
    position:relative; transition: transform .35s ease, opacity .35s ease; will-change: transform, opacity;
  }
  .suggest-item.exit-right{ transform: translateX(120%); opacity:0 }
  .suggest-item.enter-left{ position:absolute; top:0; left:0; right:0; transform: translateX(-120%); opacity:0 }
  .suggest-item.enter-left.active{ transform: translateX(0); opacity:1 }

  /* reopen pill */
  .suggest-reopen{
    display:none; align-self:flex-start; margin-top:4px;
    font-size:12px; color:#2b5bd7; background:#eef4ff; border:1px solid #cfe1ff; border-radius:999px; padding:6px 10px; cursor:pointer;
  }

  /* summary + see more */
  .summary{flex:1;padding:12px 16px;background:#fff}
  .summary p{margin:0 0 10px;line-height:1.5;font-size:14px}
  .ai-text{display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; max-height:3.1em}
  .ai-text.expanded{-webkit-line-clamp:unset; max-height:none}
  .see-more{font-size:12px; color:#2b5bd7; cursor:pointer; user-select:none}

  /* chips */
  .chips{display:flex;flex-wrap:wrap;gap:6px;margin:6px 0}
  .chip{border:1px solid var(--line);background:#f8fafc;padding:4px 8px;border-radius:999px;font-size:11px}

  /* actions */
  .actions{background:#fff;border-top:1px solid var(--line);padding:8px 12px 12px;display:grid;gap:8px}
  .btn-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:10px;border-radius:10px;border:1px solid var(--btn);background:var(--btn);color:#fff;font-weight:650;cursor:pointer;font-size:13px}
  .btn svg{width:16px;height:16px;stroke:#fff}

  /* footer */
  .tray{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;padding:8px;border-top:1px solid var(--line);background:#fff;position:sticky;bottom:0}
  .ibtn{padding:8px;border:1px solid var(--line);border-radius:10px;background:#f8fafc;display:grid;place-items:center;font-size:11px;cursor:pointer}
  .ibtn svg{width:17px;height:17px}

  svg{stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}

  /* ===== Modal (Remind Later) – INSIDE PHONE ===== */
  .modal-overlay{
    position:absolute; inset:0; background:rgba(15,45,86,.25);
    display:none; align-items:flex-end; justify-content:center; /* bottom sheet feel */
    z-index:50;
  }
  .modal{
    width:min(560px, 92vw);
    background:var(--modal-bg);
    border:1px solid var(--modal-ring);
    border-radius:18px 18px 0 0; /* bottom sheet look */
    box-shadow:var(--modal-shadow);
    padding:16px 16px 12px;
    transform:translateY(100%);
    transition:transform .28s ease;
  }
  .modal-overlay.show{display:flex}
  .modal-overlay.show .modal{transform:translateY(0)}

  .modal-header{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px;}
  .modal-title{font-weight:800; color:var(--accent); letter-spacing:.2px;}
  .modal-close{width:28px;height:28px;border-radius:8px;border:1px solid var(--pill-border);background:var(--pill-bg);display:grid;place-items:center;cursor:pointer;user-select:none;color:#4b5563;font-weight:800;}

  .quick-grid{display:grid; grid-template-columns:repeat(4,1fr); gap:8px;}
  .quick-btn{border:1px solid var(--pill-border); background:var(--pill-bg); border-radius:10px; padding:10px 8px; font-size:13px; cursor:pointer; text-align:center;}
  .quick-btn.active{ outline:2px solid var(--accent); outline-offset:1px; font-weight:700 }

  .channels{display:flex; gap:10px; flex-wrap:wrap; font-size:13px; color:#243048; margin-top:4px}
  .custom-wrap{display:none; gap:8px; margin-top:8px}
  .custom-wrap input[type="date"], .custom-wrap input[type="time"]{flex:1; padding:10px; border:1px solid #d3def0; border-radius:10px; font-size:13px; background:#fff}

  .modal-actions{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
  .btn-ghost{padding:10px 12px; border-radius:10px; border:1px solid #cbd5e1; background:#fff; color:#243048; font-size:13px; cursor:pointer}
  .btn-primary{padding:10px 14px; border-radius:10px; border:1px solid var(--btn); background:var(--btn); color:#fff; font-weight:700; cursor:pointer; font-size:13px}

  /* Blur everything under the modal */
  .phone.blur .content,
  .phone.blur .tray,
  .phone.blur .profile,
  .phone.blur .summary,
  .phone.blur .suggest,
  .phone.blur .actions{filter:blur(3px); pointer-events:none;}

  /* Push Notification */
  .push-notice{
    position:absolute;
    top:46px; /* below status bar */
    left:50%;
    transform:translateX(-50%) translateY(-120%);
    background:#0F2D56;
    color:#fff;
    padding:8px 14px;
    border-radius:12px;
    font-size:13px;
    font-weight:600;
    opacity:0;
    transition:transform .3s ease, opacity .3s ease;
    z-index:60;
    box-shadow:0 10px 24px rgba(0,0,0,.15);
    white-space:nowrap;
    max-width:calc(100% - 40px);
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .push-notice.show{transform:translateX(-50%) translateY(0); opacity:1;}
</style>
</head>
<body>
  <div class="wrap">
    <div class="phone" id="phone">
      <div class="notch"></div>
      <div class="status">
        <div class="logo"><span class="bot"></span><span>SEGWiK</span></div>
      </div>

      <!-- Push notification -->
      <div id="pushNotice" class="push-notice">Reminder set!</div>

      <!-- Feed -->
      <div class="content" id="feed"></div>

      <!-- Footer tray -->
      <div class="tray" id="footer-tray">
        <div class="ibtn" data-icon="phone"></div>
        <div class="ibtn" data-icon="mail"></div>
        <div class="ibtn" data-icon="chat"></div>
        <div class="ibtn" data-icon="calendar"></div>
        <div class="ibtn" data-icon="note"></div>
      </div>

      <!-- ===== Global Remind Later Modal (INSIDE PHONE) ===== -->
      <div id="remindOverlay" class="modal-overlay" onclick="overlayClickClose(event)">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="remindTitle" onclick="event.stopPropagation()">
          <div class="modal-header">
            <div id="remindTitle" class="modal-title">Remind Me</div>
            <div class="modal-close" onclick="closeRemindModal()">×</div>
          </div>

          <div class="modal-section">
            <div class="quick-grid">
              <button class="quick-btn" data-option="today"    onclick="selectQuickOption(this)">Later Today</button>
              <button class="quick-btn" data-option="tomorrow" onclick="selectQuickOption(this)">Tomorrow</button>
              <button class="quick-btn" data-option="week"     onclick="selectQuickOption(this)">Next Week</button>
              <button class="quick-btn" data-option="custom"   onclick="selectQuickOption(this)">Custom</button>
            </div>

            <div id="customWrap" class="custom-wrap">
              <input type="date" id="customDate">
              <input type="time" id="customTime">
            </div>
          </div>

          <div class="modal-section">
            <div style="font-weight:700;margin-bottom:6px;">Notify me via</div>
            <div class="channels">
              <label><input type="checkbox" id="ch-sms"> Text</label>
              <label><input type="checkbox" id="ch-email"> Email</label>
              <label><input type="checkbox" id="ch-push"> Push</label>
            </div>
          </div>

          <div class="modal-actions">
            <button class="btn-ghost" onclick="closeRemindModal()">Cancel</button>
            <button class="btn-primary" onclick="saveRemindFromModal()">Set Reminder</button>
          </div>
        </div>
      </div>
      <!-- /Modal -->
    </div>
  </div>

<script>
/* ===== Data ===== */
const contacts = [
  {id:'c1',name:'Steven Bowles',initials:'SB',tier:'Subscriber',segment:'Corporate',company:'Catalyst Advisory',industry:'Financial Services',website:'catalystadvisory.io',email:'steven@catalystadvisory.io',phone:'(215) 680-6887',lastContactDays:3,onJourney:true,journey:{name:'Downloaded vCard Journey',phase:'Update Contact Details',phaseDays:3},missing:['linkedin'],notes:["Prefers email mornings"],
    suggestions:[
      "Add Steven’s LinkedIn so your emails land with more context.",
      "Confirm Steven’s job title at Catalyst Advisory for accurate records.",
      "Since he prefers morning email, schedule a quick check-in for 9am.",
      "Keep momentum: advance from “Update Contact Details” once confirmed."
    ]}, 
  {id:'c2',name:'Amina Patel',initials:'AP',tier:'Contact',segment:'SMB',company:'Studio Uve',industry:'Design',website:'studiouve.com',email:'amina@studiouve.com',phone:'(732) 555-0199',lastContactDays:23,onJourney:false,journey:{name:'No Journey',phase:'No Phase',phaseDays:0},missing:['profile photo'],notes:["Tagged as potential referral partner"],
    suggestions:[
      "Add Amina to a light nurture journey to re-engage after 23 days.",
      "Upload/ask for a profile photo so teammates recognize her.",
      "Refine type: mark Amina as Referral Partner if that fits.",
      "Send a quick check-in and propose a coffee chat."
    ]}, 
  {id:'c3',name:'Carlos Ramirez',initials:'CR',tier:'Prospect',segment:'Nonprofit',company:'Arts Monmouth',industry:'Arts',website:'artsmonmouth.org',email:'director@artsmonmouth.org',phone:'(908) 555-1122',lastContactDays:8,onJourney:true,journey:{name:'Met at an Event',phase:'Manual Follow-Up',phaseDays:5},missing:['profile photo'],notes:["We met at the coffee networking at the Diner in New Jersey"],
    suggestions:[
      "Reference the NJ coffee meetup and ask for a quick follow-up call.",
      "Add a persona for Carlos to tailor your outreach tone.",
      "Add a profile photo when available for quicker recognition.",
      "If engaged, move him forward from “Manual Follow-Up”."
    ]}, 
  {id:'c4',name:'Maya Chen',initials:'MC',tier:'Warm Lead',segment:'Startup',company:'Fleetio AI',industry:'No Industry',website:'No Website',email:'maya@fleetio.ai',phone:'(646) 555-4400',lastContactDays:30,onJourney:false,journey:{name:'No Journey',phase:'No Phase',phaseDays:0},missing:['industry','website'],notes:["Met via Janet – AI fleet analytics"],
    suggestions:[
      "Add industry & website to complete Maya’s profile.",
      "Start a journey: first touch, then book intro meeting.",
      "Mention Janet’s referral to warm up your outreach.",
      "Refine contact type from Contact to Prospect if appropriate."
    ]}, 
  {id:'c5',name:'Vladimir Petrov',initials:'VP',tier:'Member',segment:'BNI',company:'Scale Partners',industry:'Advisory',website:'No Website',email:'vlad@scalepartners.io',phone:'(917) 555-7777',lastContactDays:52,onJourney:true,journey:{name:'Event Follow-Up',phase:'First Check-In',phaseDays:52},missing:['website'],notes:["Spoke at breakfast"],
    suggestions:[
      "Re-engage Vladimir with a note about his breakfast talk.",
      "Add a website for Scale Partners so you can prep before calls.",
      "Advance the journey from “First Check-In” if he replies.",
      "Confirm Vladimir’s role/title for accurate records."
    ]}
];

// per-contact suggestion index
const suggestionIndex = Object.fromEntries(contacts.map(c=>[c.id,0]));

/* ===== Render ===== */
function render(){
  document.getElementById('feed').innerHTML = contacts.map(c=>personCard(c)).join('');
}

function personCard(c){
  const chips = buildChips(c);
  const narrative = generateSummary(c);

  const personId = c.id;
  const narrativeId = `ai-${personId}`;
  const seeMoreId = `see-${personId}`;
  const suggestId = `suggest-${personId}`;
  const closeId = `close-${personId}`;
  const reopenId = `reopen-${personId}`;

  return `
  <section class="person">
    <div class="pane profile">
      <div class="avatar">${c.initials}</div>
      <div class="p-meta">
        <div class="p-name">${c.name}</div>
        <div class="p-line">${c.tier} · ${c.company || '+Add Company'}</div>
        <div class="p-extra">${displayIndustry(c.industry)} · ${displayWebsite(c.website)}</div>
        <div class="p-contact">
          <span>${icon('mail')} ${c.email}</span>
          <span>${icon('phone')} ${c.phone}</span>
        </div>
      </div>
    </div>

    <div class="summary">
      <p id="${narrativeId}" class="ai-text">${narrative}</p>
      <span id="${seeMoreId}" class="see-more" onclick="toggleSeeMore('${narrativeId}','${seeMoreId}','${suggestId}','${closeId}','${reopenId}','${personId}')">See More</span>
      <div class="chips">${chips.map(ch=>`<span class="chip">${ch}</span>`).join('')}</div>
    </div>

    <div class="suggest">
      <div id="${closeId}" class="close-x" onclick="closeSuggest('${suggestId}','${closeId}','${reopenId}')">×</div>

      <div id="${suggestId}" class="suggest-card">
        <!-- CURRENT suggestion item -->
        <div class="suggest-item">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
            <div><span class="spark">✨ Segwik Suggests:</span><br>${currentSuggestion(c)}</div>
            <a href="#" style="white-space:nowrap" onclick="minimizeSuggest('${suggestId}','${closeId}','${reopenId}','${personId}');return false;">Minimize</a>
          </div>
          <div class="links">
            <a href="#" onclick="openRemindModal('${personId}');return false;">Remind Later</a>
            <a href="#" onclick="dismissSuggestion('${suggestId}','${c.id}','${personId}');return false;">Dismiss</a>
          </div>
        </div>
      </div>

      <!-- Reopen pill -->
      <button id="${reopenId}" class="suggest-reopen" onclick="reopenSuggest('${suggestId}','${closeId}','${reopenId}','${personId}')">Segwik Suggestion</button>
    </div>

    <div class="actions">
      <div class="btn-row">
        <button class="btn">${icon('rocket')} Add to a Journey</button>
        <button class="btn">${icon('mail')} Send Email</button>
      </div>
      <div class="btn-row">
        <button class="btn">${icon('calendar')} Schedule Meeting</button>
        <button class="btn">${icon('info')} Personalize Contact</button>
      </div>
    </div>
  </section>`
}

/* ---- chips builder ---- */
function buildChips(c){
  const chips = [];
  if (c.onJourney && c.journey && c.journey.name && c.journey.name !== 'No Journey') {
    chips.push(`Journey: ${c.journey.name}`);
    if (c.journey.phase && c.journey.phase !== 'No Phase') {
      const days = (typeof c.journey.phaseDays === 'number') ? ` (${c.journey.phaseDays} days)` : '';
      chips.push(`Phase: ${c.journey.phase}${days}`);
    }
  }
  if (typeof c.lastContactDays === 'number') chips.push(`Last Contact: ${c.lastContactDays} days ago`);
  chips.push(`Contact Type: Contact`);
  if (c.persona) chips.push(`Persona: ${c.persona}`);
  if (c.notes && c.notes.length) chips.push(`Recent Note: ${c.notes[c.notes.length - 1]}`);
  if (c.company && c.company !== 'No Company') chips.push(`Company: ${c.company}`);
  if (c.jobTitle) chips.push(`Job Title: ${c.jobTitle}`);
  if (c.industry && c.industry !== 'No Industry') chips.push(`Industry: ${c.industry}`);
  if (c.website && c.website !== 'No Website') chips.push(`Website: ${c.website}`);

  const missing = [];
  if (!c.persona) missing.push('Persona');
  if (!c.jobTitle) missing.push('Job Title');
  if (Array.isArray(c.missing)) for (const m of c.missing) missing.push(formatMissingKey(m));
  if (!c.industry || c.industry === 'No Industry') missing.push('Industry');
  if (!c.website || c.website === 'No Website') missing.push('Website');
  const deduped = [...new Set(missing)].filter(Boolean);
  if (deduped.length) chips.push(`Missing Attributes: ${deduped.join(', ')}`);
  return chips;
}
function formatMissingKey(key){
  const k = String(key || '').trim().toLowerCase();
  if (!k) return '';
  if (k === 'linkedin') return 'LinkedIn';
  if (k === 'profile photo' || k === 'photo' || k === 'avatar') return 'Profile Photo';
  if (k === 'website') return 'Website';
  if (k === 'industry') return 'Industry';
  return k.replace(/\b\w/g, ch => ch.toUpperCase());
}
function displayIndustry(ind){ return (ind && ind !== 'No Industry') ? ind : '+Add Industry'; }
function displayWebsite(web){ return (web && web !== 'No Website') ? web : '+Add Website'; }

/* ---- summaries ---- */
function generateSummary(c){
  const byId = {
    'c1': `Steven is on the “Downloaded vCard Journey” in the “Update Contact Details” phase for 3 days. You last connected with him just 3 days ago, which is recent. He’s missing LinkedIn, a job title, and a persona. Your note says he prefers email in the mornings — a good cue for your next outreach.`,
    'c2': `Amina is marked as a Contact but hasn’t been placed on a journey yet. It’s been 23 days since your last touch. She’s missing a persona, profile photo, and job title. You noted she could be a referral partner, which makes her a valuable contact to refine and re-engage.`,
    'c3': `Carlos is in the “Met at an Event” journey and has been in the “Manual Follow-Up” phase for 5 days. Your last contact was 8 days ago. He’s missing a persona, profile photo, and job title. You noted you met him at a coffee networking event in New Jersey — a natural opener for the next follow-up.`,
    'c4': `Maya is saved as a Contact with Warm Lead potential, but no journey has been assigned. It’s been 30 days since your last touch. She’s missing industry, website, persona, and job title information. Your note says she was referred by Janet from the fleet analytics space — a warm way to restart the conversation.`,
    'c5': `Vladimir has been in the “Event Follow-Up” journey, stuck in the “First Check-In” phase for 52 days. Your last recorded touchpoint was also 52 days ago, so this relationship may need reactivation. He’s missing a website, persona, and job title. Your note mentions he spoke at a breakfast event — a great conversation starter for re-engagement.`
  };
  if (byId[c.id]) return byId[c.id];

  const first = c.onJourney && c.journey && c.journey.name && c.journey.name !== 'No Journey'
    ? `${c.name.split(' ')[0]} is on the “${c.journey.name}” journey in “${c.journey.phase}” for ${c.journey.phaseDays} days.`
    : `${c.name.split(' ')[0]} isn’t on a journey yet.`;
  const lastTouch = ` Last touch was ${c.lastContactDays} days ago.`;
  const missing = c.missing && c.missing.length ? ` Missing: ${c.missing.join(', ')}.` : '';
  const note = c.notes && c.notes.length ? ` Recent note: “${c.notes[c.notes.length-1]}.”` : '';
  return `${first}${lastTouch}${missing}${note}`;
}

/* ---- See More toggle (auto-minimize Suggests if expanded) ---- */
function toggleSeeMore(narrativeId, seeMoreId, suggestId, closeId, reopenId, contactId){
  const p = document.getElementById(narrativeId);
  const link = document.getElementById(seeMoreId);
  if(!p || !link) return;

  const expanded = p.classList.toggle('expanded');
  link.textContent = expanded ? 'See Less' : 'See More';

  if (expanded){
    // Auto-minimize suggestion when AI expands
    minimizeSuggest(suggestId, closeId, reopenId, contactId);
  }
}

/* ---- Suggest controls ---- */
function closeSuggest(suggestCardId, closeId, reopenId){
  const card = document.getElementById(suggestCardId);
  const closeBtn = document.getElementById(closeId);
  const reopen = document.getElementById(reopenId);
  if(card){ card.style.display = 'none'; }
  if(closeBtn){ closeBtn.style.display = 'none'; }
  if(reopen){ reopen.style.display = 'inline-block'; }
}

function minimizeSuggest(suggestCardId, closeId, reopenId /*, contactId*/){
  // same as close, but separate for clarity
  closeSuggest(suggestCardId, closeId, reopenId);
}

function reopenSuggest(suggestCardId, closeId, reopenId, contactId){
  const card = document.getElementById(suggestCardId);
  const closeBtn = document.getElementById(closeId);
  const reopen = document.getElementById(reopenId);
  if(card){ card.style.display = 'block'; }
  if(closeBtn){ closeBtn.style.display = 'grid'; }
  if(reopen){ reopen.style.display = 'none'; }
  // When Segwik Suggests is opened, minimize (collapse) AI content
  collapseAI(contactId);
}

/* ---- Remind Later MODAL logic (global) ---- */
let remindContext = { contactId: null, option: null };

function openRemindModal(contactId){
  collapseAI(contactId);
  remindContext = { contactId, option: null };

  // reset UI
  document.querySelectorAll('.quick-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('customWrap').style.display = 'none';
  document.getElementById('customDate').value = '';
  document.getElementById('customTime').value = '';
  document.getElementById('ch-sms').checked = false;
  document.getElementById('ch-email').checked = false;
  document.getElementById('ch-push').checked = false;

  const overlay = document.getElementById('remindOverlay');
  overlay.classList.add('show');
  document.getElementById('phone').classList.add('blur');
}

function closeRemindModal(){
  document.getElementById('remindOverlay').classList.remove('show');
  document.getElementById('phone').classList.remove('blur');
}

function overlayClickClose(e){
  if (e.target.id === 'remindOverlay') closeRemindModal();
}

function selectQuickOption(btn){
  document.querySelectorAll('.quick-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const opt = btn.getAttribute('data-option');
  remindContext.option = opt;

  const custom = document.getElementById('customWrap');
  custom.style.display = (opt === 'custom') ? 'grid' : 'none';
}

function saveRemindFromModal(){
  const opt = remindContext.option || 'today';
  const sms = document.getElementById('ch-sms').checked;
  const email = document.getElementById('ch-email').checked;
  const push = document.getElementById('ch-push').checked;

  let whenLabel = '';
  if (opt === 'today') whenLabel = 'Later Today';
  if (opt === 'tomorrow') whenLabel = 'Tomorrow';
  if (opt === 'week') whenLabel = 'Next Week';
  if (opt === 'custom') {
    const d = document.getElementById('customDate').value;
    const t = document.getElementById('customTime').value;
    whenLabel = (d && t) ? `Custom (${d} ${t})` : 'Custom';
  }

  const channels = [sms?'Text':null, email?'Email':null, push?'Push':null].filter(Boolean).join(', ') || 'None';

  closeRemindModal();
  showPushNotice(`Reminder set: ${whenLabel} • via ${channels}`);
}

/* Collapse AI helper for a contact */
function collapseAI(contactId){
  const p = document.getElementById(`ai-${contactId}`);
  const link = document.getElementById(`see-${contactId}`);
  if (p && p.classList.contains('expanded')){
    p.classList.remove('expanded');
    if (link) link.textContent = 'See More';
  }
}

/* ---- Dismiss: old content -> right, new -> in from left ---- */
function dismissSuggestion(suggestCardId, contactId){
  const card = document.getElementById(suggestCardId);
  if(!card) return;

  const oldItem = card.querySelector('.suggest-item');
  if(!oldItem) return;

  collapseAI(contactId);

  // Build next suggestion content
  cycleSuggestion(contactId);
  const c = contacts.find(x=>x.id===contactId);
  if(!c) return;

  // Incoming item
  const incoming = document.createElement('div');
  incoming.className = 'suggest-item enter-left';
  incoming.innerHTML = `
    <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
      <div><span class="spark">✨ Segwik Suggests:</span><br>${currentSuggestion(c)}</div>
      <a href="#" style="white-space:nowrap" onclick="minimizeSuggest('${suggestCardId}','close-${contactId}','reopen-${contactId}','${contactId}');return false;">Minimize</a>
    </div>
    <div class="links">
      <a href="#" onclick="openRemindModal('${contactId}');return false;">Remind Later</a>
      <a href="#" onclick="dismissSuggestion('${suggestCardId}','${contactId}');return false;">Dismiss</a>
    </div>
  `;
  card.appendChild(incoming);

  // Animate both ways
  oldItem.classList.add('exit-right');
  requestAnimationFrame(()=>requestAnimationFrame(()=>{
    incoming.classList.add('active'); // slide in from left
  }));

  // Cleanup after transition
  const cleanup = () => {
    oldItem.removeEventListener('transitionend', cleanup);
    if (oldItem && oldItem.parentNode) oldItem.parentNode.removeChild(oldItem);
    incoming.classList.remove('enter-left','active');
  };
  oldItem.addEventListener('transitionend', cleanup);
}

/* ---- suggestion helpers ---- */
function currentSuggestion(c){
  const idx = suggestionIndex[c.id] ?? 0;
  const list = c.suggestions && c.suggestions.length ? c.suggestions : [defaultSuggestion(c)];
  return list[idx % list.length];
}
function defaultSuggestion(c){
  if(c.missing && c.missing.includes('linkedin')) return `Check out ${c.name.split(' ')[0]}’s LinkedIn profile.`;
  if(!c.onJourney) return `Add ${c.name.split(' ')[0]} to a relevant journey to keep momentum.`;
  if(c.journey && c.journey.phaseDays>=5) return `Nudge ${c.name.split(' ')[0]} to move forward from “${c.journey.phase}.”`;
  return `Send a light check-in to stay top of mind.`;
}
function cycleSuggestion(id){
  suggestionIndex[id] = (suggestionIndex[id] ?? 0) + 1;
}

/* ---- Icons ---- */
function icon(name){
  switch(name){
    case 'mail': return `<svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M3 7l9 6 9-6"/></svg>`;
    case 'phone': return `<svg viewBox="0 0 24 24"><path d="M22 16.92v2a2 2 0 0 1-2.18 2A19.8 19.8 0 0 1 12 18a19.8 19.8 0 0 1-7.82-6.82A2 2 0 0 1 6.18 9H8a2 2 0 0 1 2 1.72c.12.9.3 1.77.57 2.61a2 2 0 0 1-.45 2.11L9 16a16 16 0 0 0 6 6l.56-1.12a2 2 0 0 1 2.11-.45c.84.27 1.71.45 2.61.57A2 2 0 0 1 22 16.92z"/></svg>`;
    case 'chat': return `<svg viewBox="0 0 24 24"><path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg>`;
    case 'calendar': return `<svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>`;
    case 'note': return `<svg viewBox="0 0 24 24"><path d="M4 3h14l2 2v16H4z"/><path d="M9 13h6M9 9h6M9 17h3"/></svg>`;
    case 'info': return `<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8h.01M11 12h2v4h-2z"/></svg>`;
    case 'rocket': return `<svg viewBox="0 0 24 24"><path d="M4.5 16.5l3 3 4.5-2.5 7-14-14 7-2.5 4.5z"/><path d="M12 12l-3 3"/></svg>`;
    default: return '';
  }
}

/* populate footer icons */
(function populateFooterIcons(){
  const tray = document.getElementById('footer-tray');
  if(!tray) return;
  tray.querySelectorAll('[data-icon]').forEach(el=>{
    const name = el.getAttribute('data-icon');
    el.innerHTML = icon(name);
  });
})();

/* Push notice helper */
function showPushNotice(msg){
  const el = document.getElementById('pushNotice');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'), 2500);
}

/* Close modal on ESC */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    closeRemindModal();
  }
});

/* initial render */
render();
</script>
</body>
</html>
